<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SURAKSHA - Medical Emergency Training{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='images/suraksha-logo.svg') }}" type="image/svg+xml">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if session.user_id %}
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/suraksha-logo.svg') }}" alt="SURAKSHA Logo" class="header-logo" style="height: 40px;">
                SURAKSHA
            </div>
            <nav class="header-nav">
                {% if session.role == 'admin' %}
                    <a href="{{ url_for('admin_dashboard') }}" class="nav-link">Dashboard</a>
                    <a href="{{ url_for('data_viewer') }}" class="nav-link">Database</a>
                {% else %}
                    <a href="{{ url_for('professional_dashboard') }}" class="nav-link">Dashboard</a>
                {% endif %}
            </nav>
            <div class="user-info">
                <span class="role-badge">{{ session.role|title }}</span>
                <span>{{ session.name }}</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </div>
    </header>
    {% endif %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container" style="padding-top: 1rem;">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'error' if category == 'error' else 'success' if category == 'success' else 'info' }}">
                        <div class="alert-content">
                            <span class="alert-message">{{ message }}</span>
                        </div>
                        <button class="alert-close" onclick="this.parentElement.style.display='none'">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <main class="page-layout">
        {% block content %}{% endblock %}
    </main>

    <script>
        // Global JavaScript functions for React-like functionality
        
        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function closeModal(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Search and filter functions
        function filterData(searchTerm, filterBy = '') {
            const cards = document.querySelectorAll('.data-card');
            let visibleCount = 0;

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                const matchesSearch = !searchTerm || text.includes(searchTerm.toLowerCase());
                const matchesFilter = !filterBy || card.dataset.filterValue === filterBy || card.classList.contains(filterBy);
                
                if (matchesSearch && matchesFilter) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Update count display if exists
            const countElement = document.querySelector('.data-count');
            if (countElement) {
                countElement.textContent = `Showing ${visibleCount} items`;
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            const targetContent = document.getElementById(tabName);
            if (targetContent) {
                targetContent.style.display = 'block';
            }
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Form validation
        function validateForm(formElement) {
            const requiredFields = formElement.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });
            
            return isValid;
        }

        // API calls (similar to React's fetch)
        async function apiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                showAlert('API request failed: ' + error.message, 'error');
                throw error;
            }
        }

        // Show alerts (similar to React's toast notifications)
        function showAlert(message, type = 'info') {
            const alertHTML = `
                <div class="alert alert-${type}" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                    <div class="alert-content">
                        <span class="alert-message">${message}</span>
                    </div>
                    <button class="alert-close" onclick="this.parentElement.remove()">&times;</button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', alertHTML);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                const alert = document.querySelector('.alert:last-of-type');
                if (alert) alert.remove();
            }, 5000);
        }

        // Confirm delete (similar to React's confirm dialog)
        function confirmDelete(message = 'Are you sure you want to delete this item?') {
            return confirm(message);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-hide alerts after 5 seconds
            document.querySelectorAll('.alert').forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                }, 5000);
            });

            // Initialize all modals
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', closeModal);
            });

            // Form validation on submit
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    if (!validateForm(this)) {
                        e.preventDefault();
                        showAlert('Please fill in all required fields', 'error');
                    }
                });
            });
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
