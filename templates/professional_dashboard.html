{% extends "base.html" %}

{% block title %}Professional Dashboard - SURAKSHA{% endblock %}

{% block content %}
<div class="container">
    <!-- Professional Dashboard Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ trainees|length }}</div>
            <div class="stat-label">My Trainees</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ trainings|length }}</div>
            <div class="stat-label">My Trainings</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ trainees|selectattr('cpr_training')|list|length }}</div>
            <div class="stat-label">CPR Trained</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ trainings|selectattr('status', 'equalto', 'Completed')|list|length }}</div>
            <div class="stat-label">Completed Trainings</div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="card">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('trainees')" data-tab="trainees">
                My Trainees
            </button>
            <button class="nav-tab" onclick="switchTab('trainings')" data-tab="trainings">
                My Trainings
            </button>
        </div>

        <!-- My Trainees Tab -->
        <div id="trainees" class="card-content tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="card-title">My Trainees</h2>
                <button class="btn btn-primary" onclick="showModal('addTraineeModal')">
                    Add New Trainee
                </button>
            </div>
            
            <div class="search-filter-bar">
                <input
                    type="text"
                    placeholder="Search by name..."
                    id="traineeSearch"
                    class="form-input search-input"
                    oninput="filterTrainees()"
                />
                <select id="traineeDeptFilter" class="form-select filter-select" onchange="filterTrainees()">
                    <option value="">All Departments</option>
                    {% for dept in trainees|map(attribute='department')|unique %}
                        {% if dept %}
                            <option value="{{ dept }}">{{ dept }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
                <select id="traineeStatusFilter" class="form-select filter-select" onchange="filterTrainees()">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="completed">Completed</option>
                </select>
            </div>

            <div class="data-grid" id="traineesGrid">
                {% for trainee in trainees %}
                <div class="data-card trainee-card" 
                     data-name="{{ trainee.name|lower }}" 
                     data-department="{{ trainee.department|lower }}"
                     data-status="{% if trainee.cpr_training and trainee.first_aid_kit_given %}completed{% else %}active{% endif %}">
                    <div class="data-card-title">{{ trainee.name }}</div>
                    <div class="data-card-content">
                        <p><strong>Mobile:</strong> {{ trainee.mobile_number }}</p>
                        <p><strong>Gender:</strong> {{ trainee.gender }}</p>
                        <p><strong>Age:</strong> {{ trainee.age }}</p>
                        <p><strong>Department:</strong> {{ trainee.department }}</p>
                        <p><strong>Block:</strong> {{ trainee.block }}</p>
                        <p><strong>Training Date:</strong> {{ trainee.training_date }}</p>
                        
                        <div style="margin-top: 0.75rem;">
                            {% if trainee.cpr_training %}
                                <span class="badge badge-success">CPR Trained</span>
                            {% endif %}
                            {% if trainee.first_aid_kit_given %}
                                <span class="badge badge-info">First Aid Kit</span>
                            {% endif %}
                            {% if trainee.life_saving_skills %}
                                <span class="badge badge-warning">Life Saving Skills</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="data-card-footer">
                        <div class="actions-cell">
                            <button class="btn btn-sm btn-info" onclick="viewTraineeDetails({{ trainee.id }})">
                                View
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="editTraineeRecord({{ trainee.id }})">
                                Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTraineeRecord({{ trainee.id }})">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- My Trainings Tab -->
        <div id="trainings" class="card-content tab-content" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 class="card-title">My Trainings</h2>
                <button class="btn btn-primary" onclick="showModal('addTrainingModal')">
                    Schedule New Training
                </button>
            </div>
            
            <div class="search-filter-bar">
                <input
                    type="text"
                    placeholder="Search by title or topic..."
                    id="trainingSearch"
                    class="form-input search-input"
                    oninput="filterTrainings()"
                />
                <select id="trainingStatusFilter" class="form-select filter-select" onchange="filterTrainings()">
                    <option value="">All Status</option>
                    <option value="planned">Planned</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>

            <div class="data-grid" id="trainingsGrid">
                {% for training in trainings %}
                <div class="data-card training-card" 
                     data-title="{{ training.title|lower }}" 
                     data-topic="{{ training.training_topic|lower }}"
                     data-status="{{ training.status|lower }}">
                    <div class="data-card-title">{{ training.title }}</div>
                    <div class="data-card-content">
                        <p><strong>Topic:</strong> {{ training.training_topic }}</p>
                        <p><strong>Date:</strong> {{ training.training_date }}</p>
                        <p><strong>Time:</strong> {{ training.training_time }}</p>
                        <p><strong>Duration:</strong> {{ training.duration_hours }} hours</p>
                        <p><strong>Location:</strong> {{ training.address }}, {{ training.block }}</p>
                        <p><strong>Max Trainees:</strong> {{ training.max_trainees }}</p>
                        {% if training.description %}
                            <p><strong>Description:</strong> {{ training.description }}</p>
                        {% endif %}
                        
                        <div style="margin-top: 0.75rem;">
                            <span class="badge {% if training.status == 'Completed' %}badge-success{% elif training.status == 'Ongoing' %}badge-warning{% elif training.status == 'Planned' %}badge-info{% else %}badge-error{% endif %}">
                                {{ training.status }}
                            </span>
                        </div>
                    </div>
                    <div class="data-card-footer">
                        <div class="actions-cell">
                            <button class="btn btn-sm btn-info" onclick="viewTrainingDetails({{ training.id }})">
                                View
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="editTrainingRecord({{ training.id }})">
                                Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTrainingRecord({{ training.id }})">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Add Trainee Modal -->
<div id="addTraineeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-2xl">
        <div class="modal-header">
            <h3 class="modal-title">Add New Trainee</h3>
            <button class="close-btn" onclick="hideModal('addTraineeModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="addTraineeForm" onsubmit="handleAddTrainee(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" name="name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mobile Number</label>
                        <input type="tel" name="mobile_number" class="form-input">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Gender *</label>
                        <select name="gender" class="form-select" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Age *</label>
                        <input type="number" name="age" class="form-input" min="16" max="100" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Department *</label>
                        <input type="text" name="department" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Designation</label>
                        <input type="text" name="designation" class="form-input">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Address *</label>
                        <input type="text" name="address" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Block *</label>
                        <select name="block" class="form-select" required>
                            <option value="">Select Block</option>
                            <option value="Raipur">Raipur</option>
                            <option value="Birgaon">Birgaon</option>
                            <option value="Abhanpur">Abhanpur</option>
                            <option value="Arang">Arang</option>
                            <option value="Dhariswa">Dhariswa</option>
                            <option value="Tilda">Tilda</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Training Date *</label>
                    <input type="date" name="training_date" class="form-input" required>
                </div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" name="cpr_training" id="cpr_training">
                        <label for="cpr_training">CPR Training Completed</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="first_aid_kit_given" id="first_aid_kit_given">
                        <label for="first_aid_kit_given">First Aid Kit Given</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" name="life_saving_skills" id="life_saving_skills">
                        <label for="life_saving_skills">Life Saving Skills Trained</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('addTraineeModal')">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Add Trainee
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Training Modal -->
<div id="addTrainingModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-2xl">
        <div class="modal-header">
            <h3 class="modal-title">Schedule New Training</h3>
            <button class="close-btn" onclick="hideModal('addTrainingModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="addTrainingForm" onsubmit="handleAddTraining(event)">
                <div class="form-group">
                    <label class="form-label">Training Title *</label>
                    <input type="text" name="title" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Training Topic *</label>
                    <input type="text" name="training_topic" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-textarea" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Address *</label>
                        <input type="text" name="address" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Block *</label>
                        <select name="block" class="form-select" required>
                            <option value="">Select Block</option>
                            <option value="Raipur">Raipur</option>
                            <option value="Birgaon">Birgaon</option>
                            <option value="Abhanpur">Abhanpur</option>
                            <option value="Arang">Arang</option>
                            <option value="Dhariswa">Dhariswa</option>
                            <option value="Tilda">Tilda</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Training Date *</label>
                        <input type="date" name="training_date" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Training Time *</label>
                        <input type="time" name="training_time" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Duration (Hours) *</label>
                        <input type="number" name="duration_hours" class="form-input" min="0.5" max="24" step="0.5" value="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Trainees *</label>
                        <input type="number" name="max_trainees" class="form-input" min="1" max="500" value="50" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('addTrainingModal')">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Schedule Training
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Data for JavaScript operations
const traineesData = {{ trainees|tojson }};
const trainingsData = {{ trainings|tojson }};

// Tab switching function
function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
    });
    
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.getElementById(tabName).style.display = 'block';
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
}

// Filter functions
function filterTrainees() {
    const searchTerm = document.getElementById('traineeSearch').value.toLowerCase();
    const deptFilter = document.getElementById('traineeDeptFilter').value.toLowerCase();
    const statusFilter = document.getElementById('traineeStatusFilter').value.toLowerCase();
    
    const cards = document.querySelectorAll('.trainee-card');
    let visibleCount = 0;
    
    cards.forEach(card => {
        const name = card.dataset.name;
        const department = card.dataset.department;
        const status = card.dataset.status;
        
        const matchesSearch = !searchTerm || name.includes(searchTerm);
        const matchesDept = !deptFilter || department.includes(deptFilter);
        const matchesStatus = !statusFilter || status.includes(statusFilter);
        
        if (matchesSearch && matchesDept && matchesStatus) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
}

function filterTrainings() {
    const searchTerm = document.getElementById('trainingSearch').value.toLowerCase();
    const statusFilter = document.getElementById('trainingStatusFilter').value.toLowerCase();
    
    const cards = document.querySelectorAll('.training-card');
    let visibleCount = 0;
    
    cards.forEach(card => {
        const title = card.dataset.title;
        const topic = card.dataset.topic;
        const status = card.dataset.status;
        
        const matchesSearch = !searchTerm || title.includes(searchTerm) || topic.includes(searchTerm);
        const matchesStatus = !statusFilter || status.includes(statusFilter);
        
        if (matchesSearch && matchesStatus) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
}

// CRUD operations for Trainees
async function handleAddTrainee(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const data = {
        name: formData.get('name'),
        mobile_number: formData.get('mobile_number'),
        gender: formData.get('gender'),
        age: parseInt(formData.get('age')),
        department: formData.get('department'),
        designation: formData.get('designation'),
        address: formData.get('address'),
        block: formData.get('block'),
        training_date: formData.get('training_date'),
        cpr_training: formData.has('cpr_training'),
        first_aid_kit_given: formData.has('first_aid_kit_given'),
        life_saving_skills: formData.has('life_saving_skills'),
        registered_by: {{ session.user_id }}
    };
    
    try {
        const response = await apiRequest('/api/trainees', {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        if (response.success) {
            showAlert('Trainee added successfully!', 'success');
            hideModal('addTraineeModal');
            form.reset();
            setTimeout(() => location.reload(), 1000);
        }
    } catch (error) {
        console.error('Error adding trainee:', error);
    }
}

// CRUD operations for Trainings
async function handleAddTraining(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const data = {
        title: formData.get('title'),
        training_topic: formData.get('training_topic'),
        description: formData.get('description'),
        address: formData.get('address'),
        block: formData.get('block'),
        training_date: formData.get('training_date'),
        training_time: formData.get('training_time'),
        duration_hours: parseFloat(formData.get('duration_hours')),
        max_trainees: parseInt(formData.get('max_trainees')),
        conducted_by: {{ session.user_id }}
    };
    
    try {
        const response = await apiRequest('/api/trainings', {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        if (response.success) {
            showAlert('Training scheduled successfully!', 'success');
            hideModal('addTrainingModal');
            form.reset();
            setTimeout(() => location.reload(), 1000);
        }
    } catch (error) {
        console.error('Error scheduling training:', error);
    }
}

// View, Edit, Delete functions
function viewTraineeDetails(id) {
    const trainee = traineesData.find(t => t.id === id);
    if (trainee) {
        alert(`Trainee Details:\n\nName: ${trainee.name}\nMobile: ${trainee.mobile_number}\nGender: ${trainee.gender}\nAge: ${trainee.age}\nDepartment: ${trainee.department}\nBlock: ${trainee.block}\nTraining Date: ${trainee.training_date}\n\nTraining Status:\n- CPR Training: ${trainee.cpr_training ? 'Completed' : 'Pending'}\n- First Aid Kit: ${trainee.first_aid_kit_given ? 'Given' : 'Not Given'}\n- Life Saving Skills: ${trainee.life_saving_skills ? 'Trained' : 'Not Trained'}`);
    }
}

function editTraineeRecord(id) {
    showAlert('Edit functionality would open edit modal with pre-filled data', 'info');
}

async function deleteTraineeRecord(id) {
    if (confirmDelete('Are you sure you want to delete this trainee?')) {
        try {
            const response = await apiRequest(`/api/trainees/${id}`, {
                method: 'DELETE'
            });
            
            if (response.success) {
                showAlert('Trainee deleted successfully!', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        } catch (error) {
            console.error('Error deleting trainee:', error);
        }
    }
}

function viewTrainingDetails(id) {
    const training = trainingsData.find(t => t.id === id);
    if (training) {
        alert(`Training Details:\n\nTitle: ${training.title}\nTopic: ${training.training_topic}\nDescription: ${training.description || 'Not provided'}\nDate: ${training.training_date}\nTime: ${training.training_time}\nDuration: ${training.duration_hours} hours\nLocation: ${training.address}, ${training.block}\nMax Trainees: ${training.max_trainees}\nStatus: ${training.status}`);
    }
}

function editTrainingRecord(id) {
    showAlert('Edit functionality would open edit modal with pre-filled data', 'info');
}

async function deleteTrainingRecord(id) {
    if (confirmDelete('Are you sure you want to delete this training?')) {
        try {
            const response = await apiRequest(`/api/trainings/${id}`, {
                method: 'DELETE'
            });
            
            if (response.success) {
                showAlert('Training deleted successfully!', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        } catch (error) {
            console.error('Error deleting training:', error);
        }
    }
}
</script>

<!-- View Trainee Modal -->
<div id="viewTraineeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-2xl">
        <div class="modal-header">
            <h3 class="modal-title">Trainee Details</h3>
            <button class="close-btn" onclick="hideModal('viewTraineeModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div id="traineeDetails"></div>
        </div>
    </div>
</div>

<!-- Edit Trainee Modal -->
<div id="editTraineeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-2xl">
        <div class="modal-header">
            <h3 class="modal-title">Edit Trainee</h3>
            <button class="close-btn" onclick="hideModal('editTraineeModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editTraineeForm" onsubmit="handleEditTrainee(event)">
                <input type="hidden" id="editTraineeId" name="trainee_id">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" id="editTraineeName" name="name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mobile Number</label>
                        <input type="tel" id="editTraineeMobile" name="mobile_number" class="form-input">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Gender *</label>
                        <select id="editTraineeGender" name="gender" class="form-select" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Age *</label>
                        <input type="number" id="editTraineeAge" name="age" class="form-input" min="16" max="100" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Department *</label>
                        <input type="text" id="editTraineeDepartment" name="department" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Designation</label>
                        <input type="text" id="editTraineeDesignation" name="designation" class="form-input">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Address *</label>
                        <input type="text" id="editTraineeAddress" name="address" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Block *</label>
                        <select id="editTraineeBlock" name="block" class="form-select" required>
                            <option value="">Select Block</option>
                            <option value="Raipur">Raipur</option>
                            <option value="Birgaon">Birgaon</option>
                            <option value="Abhanpur">Abhanpur</option>
                            <option value="Arang">Arang</option>
                            <option value="Dhariswa">Dhariswa</option>
                            <option value="Tilda">Tilda</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Training Date *</label>
                    <input type="date" id="editTraineeTrainingDate" name="training_date" class="form-input" required>
                </div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="editTraineeCpr" name="cpr_training">
                        <label for="editTraineeCpr">CPR Training Completed</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="editTraineeFirstAid" name="first_aid_kit_given">
                        <label for="editTraineeFirstAid">First Aid Kit Given</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="editTraineeLifeSaving" name="life_saving_skills">
                        <label for="editTraineeLifeSaving">Life Saving Skills Trained</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('editTraineeModal')">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Update Trainee
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- View Training Modal -->
<div id="viewTrainingModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-2xl">
        <div class="modal-header">
            <h3 class="modal-title">Training Details</h3>
            <button class="close-btn" onclick="hideModal('viewTrainingModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div id="trainingDetails"></div>
        </div>
    </div>
</div>

<!-- Edit Training Modal -->
<div id="editTrainingModal" class="modal-overlay" style="display: none;">
    <div class="modal-content max-w-2xl">
        <div class="modal-header">
            <h3 class="modal-title">Edit Training</h3>
            <button class="close-btn" onclick="hideModal('editTrainingModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editTrainingForm" onsubmit="handleEditTraining(event)">
                <input type="hidden" id="editTrainingId" name="training_id">
                <div class="form-group">
                    <label class="form-label">Training Title *</label>
                    <input type="text" id="editTrainingTitle" name="title" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Training Topic *</label>
                    <input type="text" id="editTrainingTopic" name="training_topic" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="editTrainingDescription" name="description" class="form-textarea" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Address *</label>
                        <input type="text" id="editTrainingAddress" name="address" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Block *</label>
                        <select id="editTrainingBlock" name="block" class="form-select" required>
                            <option value="">Select Block</option>
                            <option value="Raipur">Raipur</option>
                            <option value="Birgaon">Birgaon</option>
                            <option value="Abhanpur">Abhanpur</option>
                            <option value="Arang">Arang</option>
                            <option value="Dhariswa">Dhariswa</option>
                            <option value="Tilda">Tilda</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Training Date *</label>
                        <input type="date" id="editTrainingDate" name="training_date" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Training Time *</label>
                        <input type="time" id="editTrainingTime" name="training_time" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Duration (Hours) *</label>
                        <input type="number" id="editTrainingDuration" name="duration_hours" class="form-input" min="0.5" max="24" step="0.5" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Trainees *</label>
                        <input type="number" id="editTrainingMaxTrainees" name="max_trainees" class="form-input" min="1" max="500" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="editTrainingStatus" name="status" class="form-select">
                        <option value="Planned">Planned</option>
                        <option value="Ongoing">Ongoing</option>
                        <option value="Completed">Completed</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('editTrainingModal')">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Update Training
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Enhanced functions for Professional Dashboard
function viewTraineeDetails(id) {
    const traineesData = {{ trainees|tojson }};
    const trainee = traineesData.find(t => t.id === id);
    if (trainee) {
        const detailsHtml = `
            <div class="details-grid">
                <div class="detail-item">
                    <label>Name:</label>
                    <span>${trainee.name}</span>
                </div>
                <div class="detail-item">
                    <label>Mobile:</label>
                    <span>${trainee.mobile_number || 'N/A'}</span>
                </div>
                <div class="detail-item">
                    <label>Gender:</label>
                    <span>${trainee.gender}</span>
                </div>
                <div class="detail-item">
                    <label>Age:</label>
                    <span>${trainee.age}</span>
                </div>
                <div class="detail-item">
                    <label>Department:</label>
                    <span>${trainee.department}</span>
                </div>
                <div class="detail-item">
                    <label>Designation:</label>
                    <span>${trainee.designation || 'N/A'}</span>
                </div>
                <div class="detail-item">
                    <label>Address:</label>
                    <span>${trainee.address}</span>
                </div>
                <div class="detail-item">
                    <label>Block:</label>
                    <span>${trainee.block}</span>
                </div>
                <div class="detail-item">
                    <label>Training Date:</label>
                    <span>${trainee.training_date}</span>
                </div>
                <div class="detail-item">
                    <label>CPR Training:</label>
                    <span class="badge ${trainee.cpr_training ? 'badge-success' : 'badge-error'}">
                        ${trainee.cpr_training ? 'Completed' : 'Pending'}
                    </span>
                </div>
                <div class="detail-item">
                    <label>First Aid Kit:</label>
                    <span class="badge ${trainee.first_aid_kit_given ? 'badge-success' : 'badge-error'}">
                        ${trainee.first_aid_kit_given ? 'Given' : 'Not Given'}
                    </span>
                </div>
                <div class="detail-item">
                    <label>Life Saving Skills:</label>
                    <span class="badge ${trainee.life_saving_skills ? 'badge-success' : 'badge-error'}">
                        ${trainee.life_saving_skills ? 'Trained' : 'Not Trained'}
                    </span>
                </div>
            </div>
        `;
        document.getElementById('traineeDetails').innerHTML = detailsHtml;
        showModal('viewTraineeModal');
    }
}

function editTraineeRecord(id) {
    const traineesData = {{ trainees|tojson }};
    const trainee = traineesData.find(t => t.id === id);
    if (trainee) {
        document.getElementById('editTraineeId').value = trainee.id;
        document.getElementById('editTraineeName').value = trainee.name;
        document.getElementById('editTraineeMobile').value = trainee.mobile_number || '';
        document.getElementById('editTraineeGender').value = trainee.gender;
        document.getElementById('editTraineeAge').value = trainee.age;
        document.getElementById('editTraineeDepartment').value = trainee.department;
        document.getElementById('editTraineeDesignation').value = trainee.designation || '';
        document.getElementById('editTraineeAddress').value = trainee.address;
        document.getElementById('editTraineeBlock').value = trainee.block;
        document.getElementById('editTraineeTrainingDate').value = trainee.training_date;
        document.getElementById('editTraineeCpr').checked = trainee.cpr_training || false;
        document.getElementById('editTraineeFirstAid').checked = trainee.first_aid_kit_given || false;
        document.getElementById('editTraineeLifeSaving').checked = trainee.life_saving_skills || false;
        showModal('editTraineeModal');
    }
}

function viewTrainingDetails(id) {
    const trainingsData = {{ trainings|tojson }};
    const training = trainingsData.find(t => t.id === id);
    if (training) {
        const detailsHtml = `
            <div class="details-grid">
                <div class="detail-item">
                    <label>Title:</label>
                    <span>${training.title}</span>
                </div>
                <div class="detail-item">
                    <label>Topic:</label>
                    <span>${training.training_topic}</span>
                </div>
                <div class="detail-item">
                    <label>Description:</label>
                    <span>${training.description || 'N/A'}</span>
                </div>
                <div class="detail-item">
                    <label>Address:</label>
                    <span>${training.address}</span>
                </div>
                <div class="detail-item">
                    <label>Block:</label>
                    <span>${training.block}</span>
                </div>
                <div class="detail-item">
                    <label>Date:</label>
                    <span>${training.training_date}</span>
                </div>
                <div class="detail-item">
                    <label>Time:</label>
                    <span>${training.training_time}</span>
                </div>
                <div class="detail-item">
                    <label>Duration:</label>
                    <span>${training.duration_hours} hours</span>
                </div>
                <div class="detail-item">
                    <label>Max Trainees:</label>
                    <span>${training.max_trainees}</span>
                </div>
                <div class="detail-item">
                    <label>Status:</label>
                    <span class="badge ${training.status === 'Completed' ? 'badge-success' : training.status === 'Ongoing' ? 'badge-warning' : 'badge-info'}">
                        ${training.status}
                    </span>
                </div>
            </div>
        `;
        document.getElementById('trainingDetails').innerHTML = detailsHtml;
        showModal('viewTrainingModal');
    }
}

function editTrainingRecord(id) {
    const trainingsData = {{ trainings|tojson }};
    const training = trainingsData.find(t => t.id === id);
    if (training) {
        document.getElementById('editTrainingId').value = training.id;
        document.getElementById('editTrainingTitle').value = training.title;
        document.getElementById('editTrainingTopic').value = training.training_topic;
        document.getElementById('editTrainingDescription').value = training.description || '';
        document.getElementById('editTrainingAddress').value = training.address;
        document.getElementById('editTrainingBlock').value = training.block;
        document.getElementById('editTrainingDate').value = training.training_date;
        document.getElementById('editTrainingTime').value = training.training_time;
        document.getElementById('editTrainingDuration').value = training.duration_hours;
        document.getElementById('editTrainingMaxTrainees').value = training.max_trainees;
        document.getElementById('editTrainingStatus').value = training.status || 'Planned';
        showModal('editTrainingModal');
    }
}

// Edit Form Handlers
async function handleEditTrainee(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const traineeId = formData.get('trainee_id');
    
    const data = {
        name: formData.get('name'),
        mobile_number: formData.get('mobile_number'),
        gender: formData.get('gender'),
        age: parseInt(formData.get('age')),
        department: formData.get('department'),
        designation: formData.get('designation'),
        address: formData.get('address'),
        block: formData.get('block'),
        training_date: formData.get('training_date'),
        cpr_training: formData.has('cpr_training'),
        first_aid_kit_given: formData.has('first_aid_kit_given'),
        life_saving_skills: formData.has('life_saving_skills')
    };
    
    try {
        const response = await apiRequest(`/api/trainees/${traineeId}`, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
        
        if (response.success) {
            showAlert('Trainee updated successfully!', 'success');
            hideModal('editTraineeModal');
            setTimeout(() => location.reload(), 1000);
        }
    } catch (error) {
        console.error('Error updating trainee:', error);
    }
}

async function handleEditTraining(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const trainingId = formData.get('training_id');
    
    const data = {
        title: formData.get('title'),
        training_topic: formData.get('training_topic'),
        description: formData.get('description'),
        address: formData.get('address'),
        block: formData.get('block'),
        training_date: formData.get('training_date'),
        training_time: formData.get('training_time'),
        duration_hours: parseFloat(formData.get('duration_hours')),
        max_trainees: parseInt(formData.get('max_trainees')),
        status: formData.get('status')
    };
    
    try {
        const response = await apiRequest(`/api/trainings/${trainingId}`, {
            method: 'PUT',
            body: JSON.stringify(data)
        });
        
        if (response.success) {
            showAlert('Training updated successfully!', 'success');
            hideModal('editTrainingModal');
            setTimeout(() => location.reload(), 1000);
        }
    } catch (error) {
        console.error('Error updating training:', error);
    }
}
</script>

<style>
.details-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: var(--gray-50);
    border-radius: 8px;
    border-left: 4px solid var(--primary-500);
}

.detail-item label {
    font-weight: 600;
    color: var(--gray-700);
    margin: 0;
}

.detail-item span {
    color: var(--gray-900);
    text-align: right;
}

@media (min-width: 768px) {
    .details-grid {
        grid-template-columns: 1fr 1fr;
    }
}
</style>
{% endblock %}
